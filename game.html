<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Freid â€“ Play</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script data-goatcounter="https://ethereousnatsudragneel.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

<style>
  body {
    font-family: sans-serif;
    max-width: 700px;
    margin: 2rem auto;
    line-height: 1.6;
  }

  input, button {
    font-size: 1rem;
    padding: 0.5rem;
    margin-top: 0.5rem;
  }

  button {
    margin-left: 0.5rem;
  }

  #newGameBtn {
    margin-top: 1.5rem;
    display: none;
  }

  .attempt-block {
    margin-top: 1rem;
  }
</style>
</head>
<body>

<h1>Freid</h1>

<p id="instructions">
  Guess the hidden five-letter word. You have six attempts.
</p>

<div id="history">
<h2 id="attempt1"></h2>
<p id="attempt1feedback" aria-live="polite"></p>
<h2 id="attempt2"></h2>
<p id="attempt2feedback" aria-live="polite"></p>
<h2 id="attempt3"></h2>
<p id="attempt3feedback" aria-live="polite"></p>
<h2 id="attempt4"></h2>
<p id="attempt4feedback" aria-live="polite"></p>
<h2 id="attempt5"></h2>
<p id="attempt5feedback" aria-live="polite"></p>
<h2 id="attempt6"></h2>
<p id="attempt6feedback" aria-live="polite"></p>
</div>

<div id="status" style="margin-top: 1rem;"></div>

<label for="guessInput">Enter your guess:</label><br>

<input
  id="guessInput"
  type="text"
  maxlength="5"
  aria-label="Enter a 5 letter word"
>

<button id="submitBtn">Enter</button>
<button id="newGameBtn">New challenge</button>

<script>
(() => {
  let words = [];
  let safeWords = [];
  let answer = "";
  let attemptsLeft = 6;
  let attemptNumber = 0;
  let usedWords = new Set();
  let gameOver = false;

  const guessInput = document.getElementById("guessInput");
  const submitBtn = document.getElementById("submitBtn");
  const statusDiv = document.getElementById("status");
  const historyDiv = document.getElementById("history");
  const newGameBtn = document.getElementById("newGameBtn");

  const bannedPatterns = [
    /cunt/i, /fagot/i, /clit/i, /orgasm/i, /frick/i,
    /fuck/i, /shit/i, /bitch/i, /whore/i, /slut/i,
    /nigger/i, /faggot/i, /rape/i, /cock/i,
    /dick/i, /pussy/i, /asshole/i
  ];

  fetch("words.txt")
    .then(res => res.text())
    .then(text => {
      words = text.split(/\r?\n/).map(w => w.trim().toLowerCase());
      safeWords = words.filter(word =>
        !bannedPatterns.some(rx => rx.test(word))
      );
      if (!safeWords.length) safeWords = words;
      startNewGame();
    });

  function startNewGame() {
    answer = safeWords[Math.floor(Math.random() * safeWords.length)];
    attemptsLeft = 6;
    attemptNumber = 0;
    usedWords.clear();
    gameOver = false;

    for (let i = 1; i <= 6; i++) {
      document.getElementById("attempt" + i).textContent = "";
      document.getElementById("attempt" + i + "feedback").textContent = "";
    }

    statusDiv.textContent = "New game started. You have 6 attempts.";

    guessInput.disabled = false;
    submitBtn.disabled = false;
    newGameBtn.style.display = "none";
    guessInput.value = "";
    guessInput.focus();
  }

  function submitGuess() {
    if (gameOver) return;

    const guess = guessInput.value.toLowerCase().trim();

    if (guess.length !== 5 || !words.includes(guess)) {
      alert("please enter a valid 5-letter word");
      return;
    }

    if (usedWords.has(guess)) {
      alert("you have already used this word");
      return;
    }

    usedWords.add(guess);
    attemptNumber++;
    attemptsLeft--;

    renderFeedback(guess);

    if (guess === answer) {
      statusDiv.textContent = "Correct! The word was " + answer + ".";
      endGame(true);
      return;
    }

    if (attemptsLeft === 0) {
      statusDiv.textContent = "No attempts left. The correct word was " + answer + ".";
      endGame(false);
      return;
    }

    statusDiv.textContent = "Attempts remaining: " + attemptsLeft + ".";
    guessInput.value = "";
    guessInput.focus();
  }

  function renderFeedback(guess) {
    const header = document.getElementById("attempt" + attemptNumber);
    const feedback = document.getElementById("attempt" + attemptNumber + "feedback");

    header.textContent = "Attempt " + attemptNumber + ": " + guess;

    const letterCounts = {};
    for (let c of answer) {
      letterCounts[c] = (letterCounts[c] || 0) + 1;
    }

    let lines = [];

    for (let i = 0; i < 5; i++) {
      const result =
        guess[i] === answer[i] ? "correct." :
        letterCounts[guess[i]] > 0 ? "present in another position." :
        "absent.";

      if (guess[i] === answer[i] || letterCounts[guess[i]] > 0) {
        letterCounts[guess[i]]--;
      }

      lines.push(guess[i] + ": " + result);
    }

    feedback.innerHTML = lines.join("<br>");
  }

  function endGame(won) {
    gameOver = true;
    guessInput.disabled = true;
    submitBtn.disabled = true;
    newGameBtn.style.display = "inline-block";

    if (!won) {
      const reveal = document.createElement("div");
      reveal.textContent = "Answer revealed: " + answer;
      historyDiv.appendChild(reveal);
    }
  }

  submitBtn.addEventListener("click", submitGuess);
  guessInput.addEventListener("keydown", e => {
    if (e.key === "Enter") submitGuess();
  });
  newGameBtn.addEventListener("click", startNewGame);
})();
</script>

</body>
</html>
