<!DOCTYPE html>
<html lang="en">
<head>
<script data-goatcounter="https://ethereousnatsudragneel.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
<meta charset="UTF-8">
<title>Freid – Custom Challenge</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: sans-serif;
    max-width: 700px;
    margin: 2rem auto;
    line-height: 1.6;
  }

  input, button {
    font-size: 1rem;
    padding: 0.5rem;
    margin-top: 0.5rem;
  }

  button {
    margin-left: 0.5rem;
  }

  #gameSection {
    display: none;
  }

  #urlBox {
    margin-top: 1rem;
    word-break: break-all;
  }
</style>
</head>
<body>

<h1>Freid – Custom Challenge</h1>

<!-- -------- CREATE MODE -------- -->
<div id="createSection">
  <p>Create a custom five-letter word puzzle.</p>

  <label for="customWord">Enter a 5-letter word:</label><br>
  <input id="customWord" type="text" maxlength="5">
  <br>
  <button id="generateBtn">Generate</button>

  <div id="createStatus"></div>

  <div id="urlBox" style="display:none;">
    <p>Share this link:</p>
    <div id="generatedUrl"></div>
    <button id="copyBtn">Copy URL</button>
  </div>
</div>

<!-- -------- GAME MODE -------- -->
<div id="gameSection">
  <p id="instructions">
    Guess the hidden five-letter word. You have six attempts.
  </p>

  <div id="history">
    <h2 id="attempt1"></h2>
    <p id="attempt1feedback" aria-live="polite"></p>

    <h2 id="attempt2"></h2>
    <p id="attempt2feedback" aria-live="polite"></p>

    <h2 id="attempt3"></h2>
    <p id="attempt3feedback" aria-live="polite"></p>

    <h2 id="attempt4"></h2>
    <p id="attempt4feedback" aria-live="polite"></p>

    <h2 id="attempt5"></h2>
    <p id="attempt5feedback" aria-live="polite"></p>

    <h2 id="attempt6"></h2>
    <p id="attempt6feedback" aria-live="polite"></p>
  </div>

  <div id="status" style="margin-top:1rem;"></div>

  <label for="guessInput">Enter your guess:</label><br>
  <input id="guessInput" type="text" maxlength="5">
  <button id="submitBtn">Enter</button>
</div>

<script>
(() => {
  let words = [];
  let answer = "";
  let attemptsLeft = 6;
  let attemptNumber = 0;
  let usedWords = new Set();
  let gameOver = false;

  const params = new URLSearchParams(window.location.search);
  const encodedWord = params.get("word");

  const createSection = document.getElementById("createSection");
  const gameSection = document.getElementById("gameSection");

  const customWordInput = document.getElementById("customWord");
  const generateBtn = document.getElementById("generateBtn");
  const createStatus = document.getElementById("createStatus");
  const urlBox = document.getElementById("urlBox");
  const generatedUrl = document.getElementById("generatedUrl");
  const copyBtn = document.getElementById("copyBtn");

  const guessInput = document.getElementById("guessInput");
  const submitBtn = document.getElementById("submitBtn");
  const statusDiv = document.getElementById("status");

  fetch("words.txt")
    .then(res => res.text())
    .then(text => {
      words = text.split(/\r?\n/).map(w => w.trim().toLowerCase());
      if (encodedWord) startGameFromUrl(encodedWord);
    });

  function encodeWord(word) {
    return btoa(word);
  }

  function decodeWord(encoded) {
    try { return atob(encoded); }
    catch { return null; }
  }

  function genCustom() {
    const word = customWordInput.value.toLowerCase().trim();

    if (word.length !== 5) {
      alert("Word must be exactly 5 letters.");
      return;
    }

    if (!words.includes(word)) {
      alert("Word must be a valid word in English.");
      return;
    }

    const url =
      location.origin +
      location.pathname +
      "?word=" +
      encodeURIComponent(encodeWord(word));

    generatedUrl.textContent = url;
    urlBox.style.display = "block";
    createStatus.textContent = "Custom puzzle created.";
  }

  generateBtn.addEventListener("click", genCustom);
  customWordInput.addEventListener("keydown", e => {
    if (e.key === "Enter") genCustom();
  });

  copyBtn.addEventListener("click", () => {
    navigator.clipboard.writeText(generatedUrl.textContent);
    alert("URL copied to clipboard.");
  });

  function startGameFromUrl(encoded) {
    const decoded = decodeWord(encoded);

    if (!decoded || decoded.length !== 5 || !words.includes(decoded)) {
      document.body.innerHTML = "<p>Invalid or corrupted puzzle link.</p>";
      return;
    }

    answer = decoded;
    createSection.style.display = "none";
    gameSection.style.display = "block";

    statusDiv.textContent =
      "Custom puzzle loaded. You have 6 attempts.";
  }

  function submitGuess() {
    if (gameOver) return;

    const guess = guessInput.value.toLowerCase().trim();

    if (guess.length !== 5 || !words.includes(guess)) {
      alert("Please enter a valid 5-letter word.");
      return;
    }

    if (usedWords.has(guess)) {
      alert("You already used this word.");
      return;
    }

    usedWords.add(guess);
    attemptNumber++;
    attemptsLeft--;

    renderFeedback(guess);

    if (guess === answer) {
      statusDiv.textContent = "Correct! You solved the puzzle.";
      endGame();
      return;
    }

    if (attemptsLeft === 0) {
      statusDiv.textContent =
        "No attempts left. The word was " + answer + ".";
      endGame();
      return;
    }

    statusDiv.textContent =
      "Attempts remaining: " + attemptsLeft + ".";
    guessInput.value = "";
    guessInput.focus();
  }

  function renderFeedback(guess) {
    const header =
      document.getElementById("attempt" + attemptNumber);
    const feedback =
      document.getElementById("attempt" + attemptNumber + "feedback");

    header.textContent =
      "Attempt " + attemptNumber + ": " + guess;

    const letterCounts = {};
    for (let c of answer) {
      letterCounts[c] = (letterCounts[c] || 0) + 1;
    }

    const lines = [];

    for (let i = 0; i < 5; i++) {
      const result =
        guess[i] === answer[i] ? "correct." :
        letterCounts[guess[i]] > 0 ? "present in another position." :
        "absent.";

      if (guess[i] === answer[i] || letterCounts[guess[i]] > 0) {
        letterCounts[guess[i]]--;
      }

      lines.push(guess[i] + ": " + result);
    }

    feedback.innerHTML = lines.join("<br>");
  }

  function endGame() {
    gameOver = true;
    guessInput.disabled = true;
    submitBtn.disabled = true;
  }

  submitBtn.addEventListener("click", submitGuess);
  guessInput.addEventListener("keydown", e => {
    if (e.key === "Enter") submitGuess();
  });
})();
</script>

</body>
</html>
